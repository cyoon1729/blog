<head><meta charset="UTF-8"><meta name="viewport" content="width=devic-width, initial-scale=1"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&amp;display=swap"><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sakura.css/css/sakura.css" type="text/css"><style>
  * {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      font-size: 1.5rem;
      font-family: 'Roboto Mono', serif;
    }

    @media screen and (min-width: 800px) {
      body {
        background-color: #e2e2e2;
      }

       .post {
           background-color: white;
           padding: 16px;
           box-shadow: 0 0 6px rgba(0,0,0,.2);
       }
    }

    code {
      font-family: monospace;
    }

    blockquote {
      margin-left: 0px;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 600;
    }

    h2 {
      font-size: 1.5em;
    }

    h3 {
      font-size: 1.3em;
    }

    h4 {
      font-size: 1.1em;
    }

    h5 {
      font-size: 1.2em;
      text-align: center;
    }

    main {
      margin-top: 2rem;
    }

    .navbar {
      margin: 0 auto;
    }

    .tag-container {
      display: flex;
      justify-content: start;
      margin-bottom: 3rem;
      flex-wrap: wrap;
    }

    .tag {
      border: 1px solid #333333;
      border-radius: 24px;
      margin-right: 8px;
      background-color: #ffffff;
      display: inline-block;
      padding: 4px 12px;
      margin-bottom: 8px;
      font-size: 0.9em;
      color: #000000;
      cursor: pointer;
    }

    .navbar-ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      display: flex;
    }

    .navbar-li {
      margin-right: 15px;
      margin-left: 0px;
    }
    
    ul {
      margin: 0;
      padding: 0;
      display: block;
    }

    li {
      margin-left: 15px;
      float: left;
    }

    a {
      color: #1967D2;
    }

    p {
      font-size: 1.4rem;
    }

    footer {
      min-height: 50px;
    }
  </style></head><body><div class="navbar"><ul class="navbar-ul"><li class="navbar-li"><a class="sakura-fade no-border" href="/">home</a></li><li class="navbar-li"><a class="sakura-fade no-border" href="/blog">blog</a></li><li class="navbar-li"><a class="sakura-fade no-border" href="/projects">projects</a></li><li class="navbar-li"><a class="sakura-fade no-border" href="/resume">resume</a></li></ul></div><h1>Everything-I-know-about-Paxos</h1>
<p>This blog post details everything I know about Paxos, to date. With the amount
that I've actually written, this should probably be taken as a series of blog posts,
not intended to be read in a single sitting (if read at all). That
said, the post is organized as followed:</p>
<ol>
<li>[#] An introduction to the distributed consensus problem that Paxos solves</li>
<li><strong>Single(-Decree) Paxos</strong>: details the original single-decree protocol, as motivated from
the guarantees, constraints, and invariants established in Leslie Lamport's original Paxos paper,
<a href="https://lamport.azurewebsites.net/pubs/lamport-paxos.pdf"><em>The Part-Time Parliament</em></a>, and
his friendlier follow-up paper <a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf"><em>Paxos Made Simple</em></a></li>
<li><strong>Multi(-Decree) Paxos</strong>: summarizes the multi-decree protocol of the original Paxos paper and Robbert van Renesse's
<a href="https://www.cs.cornell.edu/home/rvr/Paxos/paxos.pdf"><em>Paxos Made Moderately Complex</em></a> paper, with a more
engineering perspective</li>
<li>Optimizations and Designs of Multi-Paxos concerning real-world implementations, discussed in
<em>Paxos Made Moderately Complex</em>, and <a href="https://www.scs.stanford.edu/~dm/home/papers/paxos.pdf"><em>Paxos Made Practical</em></a></li>
<li>The <a href="https://raft.github.io/raft.pdf">Raft</a> protocol and how it reduces to a special case of Paxos</li>
<li>Paxos and Raft in Production-Grade Systems</li>
<li>My Implementations of Multi-Paxos and Raft</li>
</ol>
<h3>Problem: Reaching Distributed Consesus</h3>
<h4>Guarantees</h4>
<h4>Assumptions</h4>
<p>Paxos makes two important assumptions for distributed consensus to be reached:</p>
<ul>
<li><strong>(A1)</strong> Processes in the network are <strong>asynchronous</strong>, meaning they operate at
different arbitrary speeds. Processes may also stop, fail, and restart at any time.</li>
<li><strong>(A2)</strong> The network is <strong>non-Byzantine</strong>, meaning any participant can fail, but none will
be hostile. Practically, messages can be delayed, lost, or duplicated, but never corrupted.</li>
</ul>
<h3>A Long-Winded Rambling about of Single-Paxos</h3>
<p>Single-Decree Paxos (which will now be referred to as just &quot;Paxos&quot;) is a protocol to achieve
consensus on <em>a single value</em> in an asynchronous and non-Byzantine network. Values can be
proposed within the network, one of which will be accepted and chosen.</p>
<h4>Motivating a Basic Paxos Protocol</h4>
<p>For now, let there be two kinds of processes in the network: proposers and acceptors; proposers send proposals of values
to acceptors, and the acceptors accept or reject proposals. Since arbitrarily many proposals can be made, proposals must
be identifiably unique. Moreover, for reasons that will become clear very soon, let proposal IDs be ordered
(for simplicity, assume the IDs are natural numbers). When a majority of the acceptors accept the same value,
then that value is <em>chosen</em> as the consensus. Note that the terms <em>chosen</em> and <em>accepted</em> mean two different things - <em>chosen</em>
specifically denotes <em>accepted by the majority and thus achieved consensus</em>.</p>
<p>For a consensus to be reached at all, a value must be chosen among the proposed values. Thus, the following
requirement is made:</p>
<ul>
<li><strong>(R1)</strong> An acceptor must accept the first proposal <code>n</code> it receives (and it may accept new proposals afterwards)</li>
</ul>
<p>This alone is problematic because different proposals can arrive simultaneously at acceptors, and which
of those is read first is generally undefined. This, and with the condition that an acceptor can accept subsequent
proposals after it had already accepted one, can result in there being no majority vote
for a single value (ever) - then no consensus can maintained. To overcome that, require the following as well:</p>
<ul>
<li><strong>(R2)</strong> If a value <code>v</code> of a proposal <code>n</code> is chosen, then any higher-numbered proposal <code>m &gt; n</code> that is
<em>chosen</em> must have value <code>v</code></li>
</ul>
<p>This guarantees that a consensus (a single chosen value) can be maintained. Consider the following strenghtening of
(R2):</p>
<ul>
<li><strong>(R2')</strong> If a value <code>v</code> of a proposal <code>n</code> is chosen, then any higher-numbered proposal <code>m &gt; n</code> <em>issued by any proposer has value</em> <code>v</code></li>
</ul>
<p>Obviously, (R2) still holds via enforcing (R2'). A consensus protocol requiring (R1) and (R2') thus guarantees that
only a value that has been proposed may be chosen (G1), and that only a single value can be chosen (G2), as desired.
(R1) is easy to enforce; the goal is to design a protocol such that (R2') is never violated.</p>
<p>In <em>Paxos Made Simple</em> [2], a protocol to satisfy the requirements above is motivated as followed: suppose we wanted to prove
that (R2') holds, via induction. Let there be a proposal <code>n</code> with value <code>v</code> that is chosen, and assume all proposals <code>n+1, n+2, ..., m-1</code>
issued up to some <code>m-1</code> have value <code>v</code>. Given this inductive hypothesis, a working protocol should have the proposal <code>m</code> issued necessarily have value <code>v</code>.
First, for <code>v</code> to have been chosen, there must have been some set <code>C</code> that contains a majority of the acceptors, that have all accepted <code>v</code>
from any of the proposals <code>n, n+1, ..., m-1</code>. Since <code>C</code> is a majority set, any other majority set <code>S</code> will have nonempty intersection with
<code>C</code>. By forcing the following invariant, the next proposal <code>n</code> issued will necessarily have value <code>v</code>:</p>
<ul>
<li><strong>(I1)</strong> For any <code>v</code> and <code>n</code>, if a proposal with value <code>v</code> and ID <code>n</code> is issued, then there is a set <code>S</code> containing a majority of the acceptors
such that (a) no acceptor in <code>S</code> has accepted a proposal of ID less than <code>n</code>, or (b) <code>v</code> is the value of the highest-numbered proposal among
all proposals numbered less than <code>n</code> accepted by acceptors in <code>S</code></li>
</ul>
<p>Thus, (R2') can be satisfied as long as the invariant (I1) is maintained, and so a desired protocol can be designed around this invariant.</p>
<h4>The Synod Protocol</h4>
<ul>
<li><strong>(R2a)</strong></li>
<li><strong>(R2b)</strong></li>
<li><strong>(R2c)</strong></li>
</ul>
<p>To summarize the protocol developed so far:</p>
<h3>Multi-Paxos</h3>
<h3>Optimizations and Designs for Multi-Paxos</h3>
<h3>&quot;Raft is a Special Case of Paxos&quot;</h3>
<h3>Paxos and Raft in the Real World</h3>
<h3>An Implementation of Multi-Paxos</h3>
<h3>References</h3>
<p>Here are all resources/papers referenced in the post:</p>
<ul>
<li>[1] <a href="https://lamport.azurewebsites.net/pubs/lamport-paxos.pdf">The Part-Time Parliament</a></li>
<li>[2] <a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf">Paxos Made Simple</a></li>
<li>[3] <a href="https://www.cs.cornell.edu/home/rvr/Paxos/paxos.pdf">Paxos Made Moderately Complex</a></li>
<li>[4] <a href="https://www.scs.stanford.edu/~dm/home/papers/paxos.pdf">Paxos Made Practical</a></li>
<li>[5] <a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm (Raft)</a></li>
<li>[6] <a href="https://static.googleusercontent.com/media/research.google.com/en//archive/paxos_made_live.pdf">Paxos Made Live</a></li>
</ul>
</body>